#!/bin/bash

function watch {
  echo # Force first execution
  inotifywait --recursive --monitor --include '\.go$' --event modify,create,delete .
}

while read -r file; do
  if [ -n "$cid" ]; then
    kill "$cid" 2>/dev/null
    wait "$cid" 2>/dev/null
  fi
  go run *.go &
  cid=$!
done < <(watch)
